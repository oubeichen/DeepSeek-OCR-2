# DeepSeek-OCR-2 API Server Configuration
# Copy this file to .env and modify as needed
#
# All variables use prefix: DEEPSEEK_OCR2_
# Priority: CLI args > Environment variables > .env file > defaults (config.py)

# ============================================================
# Model Settings
# ============================================================
# Model path (HuggingFace model ID or local path)
DEEPSEEK_OCR2_MODEL_PATH=deepseek-ai/DeepSeek-OCR-2

# Model data type: bfloat16, float16, float32
DEEPSEEK_OCR2_DTYPE=bfloat16

# Trust remote code from HuggingFace
DEEPSEEK_OCR2_TRUST_REMOTE_CODE=true

# ============================================================
# GPU Settings
# ============================================================
# GPU memory utilization ratio (0.1 - 1.0)
DEEPSEEK_OCR2_GPU_MEMORY_UTILIZATION=0.9

# Tensor parallel size (number of GPUs)
DEEPSEEK_OCR2_TENSOR_PARALLEL_SIZE=1

# CUDA visible devices (comma-separated GPU IDs)
DEEPSEEK_OCR2_CUDA_VISIBLE_DEVICES=0

# ============================================================
# vLLM Engine Settings
# ============================================================
# Maximum model context length
DEEPSEEK_OCR2_MAX_MODEL_LEN=8192

# Block size for KV cache
DEEPSEEK_OCR2_BLOCK_SIZE=256

# Use eager mode (disable CUDA graphs)
DEEPSEEK_OCR2_ENFORCE_EAGER=false

# Swap space in GB
DEEPSEEK_OCR2_SWAP_SPACE=0

# Maximum number of sequences
DEEPSEEK_OCR2_MAX_NUM_SEQS=100

# Disable multimodal preprocessor cache
DEEPSEEK_OCR2_DISABLE_MM_PREPROCESSOR_CACHE=true

# ============================================================
# Sampling Settings
# ============================================================
# Sampling temperature (0.0 for deterministic)
DEEPSEEK_OCR2_TEMPERATURE=0.0

# Maximum tokens to generate
DEEPSEEK_OCR2_MAX_TOKENS=8192

# N-gram size for repetition penalty
DEEPSEEK_OCR2_NGRAM_SIZE=20

# Window size for N-gram check (image: 90, pdf default: 50)
DEEPSEEK_OCR2_WINDOW_SIZE=90

# Skip special tokens in output
DEEPSEEK_OCR2_SKIP_SPECIAL_TOKENS=false

# ============================================================
# Image Processing Settings
# ============================================================
# Enable dynamic cropping
DEEPSEEK_OCR2_CROP_MODE=true

# Minimum number of crops
DEEPSEEK_OCR2_MIN_CROPS=2

# Maximum number of crops
DEEPSEEK_OCR2_MAX_CROPS=6

# Local view image size
DEEPSEEK_OCR2_IMAGE_SIZE=768

# Global view base size
DEEPSEEK_OCR2_BASE_SIZE=1024

# ============================================================
# PDF Processing Settings
# ============================================================
# PDF to image conversion DPI
DEEPSEEK_OCR2_PDF_DPI=144

# Page separator in output (use literal \n for newline)
DEEPSEEK_OCR2_PAGE_SEPARATOR=\n<--- Page Split --->\n

# Skip pages with repeated/incomplete content
DEEPSEEK_OCR2_SKIP_REPEAT_PAGES=true

# ============================================================
# Server Settings
# ============================================================
# Server host
DEEPSEEK_OCR2_HOST=0.0.0.0

# Server port
DEEPSEEK_OCR2_PORT=8000

# Number of preprocessing workers
DEEPSEEK_OCR2_NUM_WORKERS=64

# ============================================================
# Task Queue Settings (Smart Concurrent Processing)
# ============================================================
# Maximum concurrent inference requests (pages) across all tasks
# Controls GPU utilization - higher values use more VRAM but process faster
# Recommended: 2-8 depending on GPU memory and model size
DEEPSEEK_OCR2_INFERENCE_CONCURRENCY=4

# Upper limit of concurrent pages per file
# Smart scheduling dynamically adjusts actual concurrency based on active tasks:
#   - 1 file in queue: uses all inference_concurrency slots (e.g., 4)
#   - 2 files in queue: each gets half (e.g., 2 each)
#   - 4+ files in queue: each gets at least 1 slot
# This setting caps the maximum any single file can use
# Set to inference_concurrency or higher to allow full utilization for single files
DEEPSEEK_OCR2_MAX_PAGES_PER_FILE=32

# ============================================================
# Task Storage Settings
# ============================================================
# Directory for task data and output files
DEEPSEEK_OCR2_TASK_STORAGE_DIR=/tmp/deepseek_ocr2_tasks

# Enable task persistence across server restarts
DEEPSEEK_OCR2_TASK_PERSISTENCE=true

# Days to keep completed tasks (0 = no time limit)
# Cleanup runs automatically on new file upload
DEEPSEEK_OCR2_TASK_RETENTION_DAYS=7

# Maximum number of tasks to keep (0 = no limit)
# Keeps the most recent tasks when limit is exceeded
DEEPSEEK_OCR2_TASK_RETENTION_COUNT=100

# ============================================================
# Prompt Settings
# ============================================================
# Default OCR prompt
DEEPSEEK_OCR2_DEFAULT_PROMPT=<image>\n<|grounding|>Convert the document to markdown.
